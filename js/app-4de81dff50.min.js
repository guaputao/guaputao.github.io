!function(e,t){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},Date.prototype.getDays=function(){var e=new Date(this);return e.setMonth(0),e.setDate(1),(this-e)/864e5+1};var a=function(e){var t=parseInt(e),a=parseInt(60*(e-t)),i=parseInt(60*(60*(e-t)-a)),s=new Date;return s.setHours(t,a,i),s},i=8,s="39.1308696361",l="116.3969529411",n=a(function(){var e=new Date;return(180+15*i-l-180*Math.acos(Math.tan(10547*Math.PI/81e3*Math.cos(2*Math.PI*(e.getDays()+9)/365))*Math.tan(s*Math.PI/180))/Math.PI)/15}()),o=a(function(){var e=new Date;return(180+15*i-l+180*Math.acos(Math.tan(10547*Math.PI/81e3*Math.cos(2*Math.PI*(e.getDays()+9)/365))*Math.tan(s*Math.PI/180))/Math.PI)/15}()),d={},r={showMeridian:!1,disableMousewheel:!1,showSeconds:!0},c=[{mode:{id:0,label:"固定时间"},time:{id:0,label:"00:00:00"},detail:"……",name:"清晨",policy:{id:0,label:"全部关闭"}},{mode:{id:1,label:"自动模式"},time:{id:1,label:n.Format("hh:mm:ss")},detail:"日出时间",name:"清晨",policy:{id:0,label:"全部关闭"},offsetTime:0}],m=function(e){var t=1===e.time.id?n:o,a=1e3*e.offsetTime*60;return t=new Date(t.getTime()+a),t.Format("hh:mm:ss")},p=function(e){return'<div> <div> <div class="form-horizontal"> <form role="form"> <div class="form-group"> <label class="col-sm-4 control-label">地区:</label> <div class="col-sm-8 justify-label">霸州 </div> </div> <div class="form-group"> <label class="col-sm-4 control-label">当前时间:</label> <div class="col-sm-8 justify-label">'+(new Date).Format("yyyy-MM-dd hh:mm:ss")+'</div> </div> <div class="form-group"> <label class="col-sm-4 control-label">参考时间:</label> <div class="col-sm-8 justify-label">  <label class="radio-label"> <input type="radio" name="time" id="sunupRadio" value="1"/>日出<span class="time-label"> '+n.Format("yyyy-MM-dd hh:mm:ss")+'</span> </label> <label class="radio-label"> <input type="radio" name="time" id="sunsetRadio" value="2"/>日落<span class="time-label"> '+o.Format("yyyy-MM-dd hh:mm:ss")+'</span> </label></div> </div> <div class="form-group"> <label class="col-sm-4 control-label">在此时间上推移:</label> <div class="col-sm-8 justify-label"><select class="form-control offset-select"><option value="0">提前</option><option value="1">推迟</option></select><input type="number" min="0" class="form-control offset-input" value="'+Math.abs(e.offsetTime)+'" id="offsetTimeInput">分钟 <span id ="offsetTimeLabel">'+m(e)+"</span></div> </div> </form> </div> </div> </div>"},f=function(e,t,a){return'<div class="modal fade" id='+a+' tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="glyphicon glyphicon-remove"></i></button> <h4 class="modal-title" id="myModalLabel">'+e+'</h4> </div><div class="modal-body">'+t+'</div> <div class="modal-footer"><div class="modal-button-wrapper"><button type="button" class="btn btn-primary" data-dismiss="modal" id="okButton">确定</button><button type="button" class="btn btn-grey" data-dismiss="modal">取消</button> </div> </div> </div> </div>'},u=function(e,a){for(var i=0;i<e.length;i++)if(parseInt(e[i].value)===a.time.id){e[i].checked=!0,t(e[i]).next().css("display","inline-block");break}},v=function(e,a,i){var s=p(a);t(".wrapper").append(f("根据日出日落智能设置",s,"myModal"));var l=document.getElementsByName("time");t(".time-label").css("display","none"),u(l,a),M(t(".offset-select ")[0],a.offsetTime>0?1:0),t("#sunupRadio").click(function(){t(".time-label").css("display","none"),t(this).attr("checked",!0),t(this).next().css("display","inline-block"),a.time.id=1;var e=m(a);t("#offsetTimeLabel").text(e),a.time.label=e}),t("#sunsetRadio").click(function(){t(".time-label").css("display","none"),t(this).attr("checked",!0),t(this).next().css("display","inline-block"),a.time.id=2;var e=m(a);t("#offsetTimeLabel").text(e),a.time.label=e}),t("#offsetTimeInput").change(function(){a.offsetTime=parseInt(t(".offset-select option:selected").val())?parseInt(t(this).val()):0-parseInt(t(this).val());var e=m(a);t("#offsetTimeLabel").text(e)}),t("#okButton").click(function(){if(a.time.label=t("#offsetTimeLabel").text(),a.offsetTime){var s=1===a.time.id?"日出":"日落",l=a.offsetTime>0?"推迟":"提前";a.detail=s+l+Math.abs(a.offsetTime)+"分钟"}else a.detail=1===a.time.id?"日出时间":"日落时间";t.extend(!0,i,a),console.log(e[0]),e.find(".timepickerInput").timepicker("setTime",i.time.label),e.parent().next().find("div").text(i.detail)}),t(".offset-select").change(function(){a.offsetTime=parseInt(t(".offset-select option:selected").val())?Math.abs(i.offsetTime):0-Math.abs(i.offsetTime);var e=m(a);t("#offsetTimeLabel").text(e)})},h=function(e,a){return function(){d={},t.extend(!0,d,a),v(e,d,a),t("#myModal").on("hide.bs.modal",function(){t(this).remove()})}},b=function(e){return function(){if("images/edit.png"===t(this).attr("src"))t(this).attr("src","images/ok.png"),t(this).prev().remove(),t("<input type='text'></input>").insertBefore(this).val(e.name);else{t(this).attr("src","images/edit.png");var a=t(this).prev().val();e.name=a,t(this).prev().remove(),t("<span></span>").insertBefore(this).text(e.name)}}},g=function(e,a){var i=t("<img class='edit-time' data-toggle='modal' data-target='#myModal' src='images/edit.png'></img>");i.click(h(e,a)),e.append(i)},y=function(e,a){return function(){t(this)[0].options[1].selected?(g(e,a),a.time={id:1,label:n.Format("hh:mm:ss")},a.detail="日出时间",a.offsetTime=0,e.find(".timepickerInput").timepicker("setTime",a.time.label),e.find(".timepickerInput").attr("disabled",!0),e.parent().next().find("div").text(a.detail)):(t(e).find("img").remove(),a.detail="……",e.parent().next().find("div").text(a.detail),e.find(".timepickerInput").attr("disabled",!1))}},M=function(e,t){for(var a=0;a<e.options.length;a++)if(e.options[a].value==t){e.options[a].selected=!0;break}},k=function(e){var a=t("<tr></tr>"),i=t("<select class='form-control'><option value='0'>固定时间</option> <option value='1'>自动模式</option></select>");M(i[0],e.mode.id);var s=t("<td></td>");s.append(i);var l=t("<div class='input-group bootstrap-timepicker timepicker'><input class='timepickerInput' type='text' class='form-control input-small'></div>");e.mode.id&&(g(l,e),l.find(".timepickerInput").attr("disabled",!0)),i.change(y(l,e));var n=t("<td></td>");n.append(l);var o=t("<div>"+e.detail+"</div>"),d=t("<td></td>");d.append(o);var c=t("<img class='edit-time' src='images/edit.png'></img>");c.click(b(e));var m=t("<div class='name-wrapper'><span>"+e.name+"</span></div>");m.append(c);var p=t("<td></td>");p.append(m);var f=t("<select class='form-control'><option value='0'>全部关闭</option> <option value='1'>全部打开</option></select>"),u=t("<td></td>");u.append(f),a.append(s),a.append(n),a.append(d),a.append(p),a.append(u),t(".table > tbody").append(a),t.extend(r,{defaultTime:e.time.label}),t(".timepickerInput").timepicker(r)},x=function(){t.each(c,function(e,t){k(t)})};t(function(){x()});var I=function(){k({mode:{id:0,label:"固定时间"},time:{id:0,label:"00:00:00"},detail:"……",name:"清晨",policy:{id:0,label:"全部关闭"}})},T=function(){t(".wrapper").append(f("温馨提示","<h4>当前设置保存成功!</h4>","okModal")),t("#okModal").modal(),t("#okModal").on("hide.bs.modal",function(){t(this).remove()})},w=function(){location.reload()};e.addTime=I,e.save=T,e.cancel=w}(window,jQuery),window;